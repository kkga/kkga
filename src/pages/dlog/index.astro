---
import PageLayout from "@/layouts/PageLayout.astro";
import { getCollection, render } from "astro:content";

const data = await getCollection("dlog");
const sorted = data.sort((a, b) => {
  return b.data.date.getTime() - a.data.date.getTime();
});

const rendered = await Promise.all(
  sorted.map(async (entry) => {
    const { Content } = await render(entry);
    return {
      ...entry,
      title: entry.data.title,
      dateLabel: entry.data.date.toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      }),
      dateTime: entry.data.date.toISOString(),
      Content,
    };
  })
);
---

<PageLayout title="Dlog" description="dev- or design-log attempt">
  {
    rendered.map(({ Content, dateLabel, dateTime, title }, index) => (
      <>
        <article class="col-span-full grid grid-cols-subgrid gap-5">
          <h2 class="col-[head] place-self-start">{title}</h2>
          <aside class="col-[aside] place-self-start text-secondary">
            <time datetime={dateTime}>{dateLabel}</time>
          </aside>
          <div class="col-[content] grid grid-cols-subgrid gap-5 *:col-[content] md:row-start-2 lg:row-start-1">
            <Content />
          </div>
        </article>
        {index < rendered.length - 1 && <hr />}
      </>
    ))
  }
</PageLayout>
