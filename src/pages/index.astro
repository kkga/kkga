---
import PageLayout from "@/layouts/PageLayout.astro";
import siteData from "../data/site.json";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const work = await getCollection("work").then((work) =>
  work.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  )
);

const projects = await getCollection("projects").then((projects) =>
  projects.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  )
);
---

<PageLayout
  title={siteData.title}
  description={siteData.description}
  dateUpdated="2025-01-23"
>
  <h2>Work</h2>

  <ul class="col-[bleed] grid grid-cols-subgrid gap-5 *:md:col-span-2">
    {
      work.map(({ id, data }) => (
        <li class="flex">
          <a href={`/work/${id}`} class="group bg-transparent no-underline">
            <div class="relative mb-2.5 w-full overflow-hidden shadow">
              <Image
                src={data.cover}
                alt={data.title}
                class="block w-full object-cover"
              />
              <span class="pointer-events-none absolute inset-0 z-10 inset-ring inset-ring-current/15" />
            </div>
            <span class="group-hover:underline">
              <span class="uppercase">{data.title}</span>
              <span>
                ({data.role} {data.timeframe})
              </span>
            </span>
            <div class="text-secondary">{data.longDescription}</div>
          </a>
        </li>
      ))
    }
  </ul>

  <hr />

  <h2>Projects</h2>

  <ul
    class="col-[bleed] grid grid-cols-subgrid gap-5 *:md:col-span-2 *:xl:col-span-1"
  >
    {
      projects.map(({ id, data }) => (
        <li class="flex">
          <a href={`/projects/${id}`} class="group bg-transparent no-underline">
            <div class="relative mb-2.5 w-full overflow-hidden shadow">
              <Image
                src={data.cover}
                alt={data.title}
                class="block w-full object-cover"
              />
              <span class="pointer-events-none absolute inset-0 z-10 inset-ring inset-ring-current/15" />
            </div>
            <span class="group-hover:underline">
              <span class="uppercase">{data.title}</span>
              <span>
                {`(${new Date(data.date).toLocaleDateString("en-US", { year: "numeric" })})`}
              </span>
            </span>
            <div class="text-secondary">
              {data.description.replace(/\.$/, "")}.
            </div>
          </a>
        </li>
      ))
    }
  </ul>
</PageLayout>
